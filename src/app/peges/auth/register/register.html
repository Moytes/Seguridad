<p-toast />

<div class="auth-container">
    <p-card>
        <div class="auth-header">
            <div class="auth-icon">
                <i class="pi pi-user-plus"></i>
            </div>
            <h2>Crear Cuenta</h2>
            <p>Completa tus datos para registrarte</p>
        </div>

        <form [formGroup]="registerForm" (ngSubmit)="onRegister()" class="auth-form">

            <div class="field">
                <label for="usuario">Usuario</label>
                <input id="usuario" type="text" pInputText placeholder="Nombre de usuario" formControlName="usuario"
                    [class.ng-invalid]="f.usuario.invalid && (f.usuario.touched || submitted())"
                    [class.ng-dirty]="f.usuario.touched || submitted()" />
                @if (f.usuario.invalid && (f.usuario.touched || submitted())) {
                @if (f.usuario.errors?.['required']) {
                <p-message severity="error" size="small" variant="simple">El usuario es obligatorio</p-message>
                } @else if (f.usuario.errors?.['minlength']) {
                <p-message severity="error" size="small" variant="simple">Mínimo 3 caracteres</p-message>
                }
                }
            </div>

            <div class="field">
                <label for="email">Correo Electrónico</label>
                <input id="email" type="email" pInputText placeholder="tu@email.com" formControlName="email"
                    [class.ng-invalid]="f.email.invalid && (f.email.touched || submitted())"
                    [class.ng-dirty]="f.email.touched || submitted()" />
                @if (f.email.invalid && (f.email.touched || submitted())) {
                @if (f.email.errors?.['required']) {
                <p-message severity="error" size="small" variant="simple">El correo es obligatorio</p-message>
                } @else if (f.email.errors?.['email']) {
                <p-message severity="error" size="small" variant="simple">Ingresa un correo válido</p-message>
                }
                }
            </div>

            <div class="field">
                <label for="nombreCompleto">Nombre Completo</label>
                <input id="nombreCompleto" type="text" pInputText placeholder="Tu nombre completo"
                    formControlName="nombreCompleto"
                    [class.ng-invalid]="f.nombreCompleto.invalid && (f.nombreCompleto.touched || submitted())"
                    [class.ng-dirty]="f.nombreCompleto.touched || submitted()" />
                @if (f.nombreCompleto.invalid && (f.nombreCompleto.touched || submitted())) {
                @if (f.nombreCompleto.errors?.['required']) {
                <p-message severity="error" size="small" variant="simple">El nombre es obligatorio</p-message>
                } @else if (f.nombreCompleto.errors?.['minlength']) {
                <p-message severity="error" size="small" variant="simple">Mínimo 3 caracteres</p-message>
                }
                }
            </div>

            <div class="field">
                <label for="telefono">Teléfono</label>
                <input id="telefono" type="tel" pInputText placeholder="Ej: 5512345678" formControlName="telefono"
                    (keypress)="soloNumeros($event)" (paste)="onPegarTelefono($event)" maxlength="10"
                    [class.ng-invalid]="f.telefono.invalid && (f.telefono.touched || submitted())"
                    [class.ng-dirty]="f.telefono.touched || submitted()" />
                @if (f.telefono.invalid && (f.telefono.touched || submitted())) {
                @if (f.telefono.errors?.['required']) {
                <p-message severity="error" size="small" variant="simple">El teléfono es obligatorio</p-message>
                } @else if (f.telefono.errors?.['pattern']) {
                <p-message severity="error" size="small" variant="simple">Solo se permiten números</p-message>
                } @else if (f.telefono.errors?.['minlength'] || f.telefono.errors?.['maxlength']) {
                <p-message severity="error" size="small" variant="simple">Debe tener exactamente 10 dígitos</p-message>
                }
                }
            </div>

            <div class="field">
                <label for="direccion">Dirección</label>
                <input id="direccion" type="text" pInputText placeholder="Tu dirección" formControlName="direccion"
                    [class.ng-invalid]="f.direccion.invalid && (f.direccion.touched || submitted())"
                    [class.ng-dirty]="f.direccion.touched || submitted()" />
                @if (f.direccion.invalid && (f.direccion.touched || submitted())) {
                @if (f.direccion.errors?.['required']) {
                <p-message severity="error" size="small" variant="simple">La dirección es obligatoria</p-message>
                }
                }
            </div>

            <div class="field">
                <label for="fechaNacimiento">Fecha de Nacimiento</label>
                <p-datepicker id="fechaNacimiento" formControlName="fechaNacimiento" [maxDate]="maxDate"
                    dateFormat="dd/mm/yy" placeholder="dd/mm/aaaa" [showIcon]="true" styleClass="w-full"
                    inputStyleClass="w-full"
                    [class.ng-invalid]="f.fechaNacimiento.invalid && (f.fechaNacimiento.touched || submitted())"
                    [class.ng-dirty]="f.fechaNacimiento.touched || submitted()" />
                @if (f.fechaNacimiento.invalid && (f.fechaNacimiento.touched || submitted())) {
                @if (f.fechaNacimiento.errors?.['required']) {
                <p-message severity="error" size="small" variant="simple">La fecha de nacimiento es
                    obligatoria</p-message>
                } @else if (f.fechaNacimiento.errors?.['menorDeEdad']) {
                <p-message severity="warn" size="small" variant="simple">Debes ser mayor de 18 años</p-message>
                }
                }
            </div>

            <div class="field">
                <label for="password">Contraseña</label>
                <p-password id="password" formControlName="password" placeholder="Exactamente 10 caracteres"
                    [toggleMask]="true" [maxLength]="10" styleClass="w-full" inputStyleClass="w-full" />
                @if (f.password.invalid && (f.password.touched || submitted())) {
                @if (f.password.errors?.['required']) {
                <p-message severity="error" size="small" variant="simple">La contraseña es obligatoria</p-message>
                } @else if (f.password.errors?.['minlength'] || f.password.errors?.['maxlength']) {
                <p-message severity="error" size="small" variant="simple">Debe tener exactamente 10
                    caracteres</p-message>
                } @else if (f.password.errors?.['pattern']) {
                <p-message severity="warn" size="small" variant="simple">Debe incluir al menos un carácter especial
                    (!&#64;#$%^&*)</p-message>
                }
                }
            </div>

            <div class="field">
                <label for="confirmPassword">Confirmar Contraseña</label>
                <p-password id="confirmPassword" formControlName="confirmPassword" placeholder="Repite tu contraseña"
                    [toggleMask]="true" [feedback]="false" styleClass="w-full" inputStyleClass="w-full" />
                @if (f.confirmPassword.invalid && (f.confirmPassword.touched || submitted())) {
                @if (f.confirmPassword.errors?.['required']) {
                <p-message severity="error" size="small" variant="simple">Debes confirmar tu contraseña</p-message>
                }
                }
                @if (registerForm.errors?.['passwordsMismatch'] && (f.confirmPassword.touched || submitted())) {
                <p-message severity="error" size="small" variant="simple">Las contraseñas no coinciden</p-message>
                }
            </div>

            <p-button label="Registrarse" icon="pi pi-user-plus" type="submit" severity="primary" styleClass="w-full"
                [disabled]="registerForm.invalid && submitted()" />
        </form>

        <div class="auth-footer">
            <p>¿Ya tienes cuenta? <a routerLink="/login">Inicia sesión aquí</a></p>
            <p><a routerLink="/">← Volver al inicio</a></p>
        </div>
    </p-card>
</div>